\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{mathtools}
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{tikz}
\usepackage{hyperref}

\title{Equivariant Structured Positional Rotations}
\author{}
\date{}

\begin{document}

\maketitle

\section*{Integrated Writeup}

Throughout we work inside the universe $\{ \mathbb{R}, \mathbb{C}, \mathbb{N}, \text{matrices}, \text{vectors} \}$ and adhere to the conventions stated below. Every claim is tied to an explicit boxed statement. Cleanups $\mathsf{cleanup}$ add the missing boxes $[2.4]$, $[2.7]$, $[2.9]$, $[2.16]$, $[3.6\mathrm{a}]$, $[5.4\mathrm{a}]$, $[5.11]$ and expand the algebra in $[2.1]$, $[2.2]$, $[3.11]$. None of these touch the hypotheses $[1.2]$, $[1.3]$ or constructions $[2.12]$, $[3.7]$, $[4.1]$, so the main theorem (statement $[5.9]$) remains unchanged.

\subsection*{Global Conventions}

All matrices are real unless noted otherwise. Vectors are real column vectors. Transpose is $^\top$; conjugate transpose is $^*$. We write $[A,B] := AB - BA$, use direct sums $\oplus$, and denote block-diagonal concatenation over $u\in\{1,\dots,m\}$ by $\bigoplus_{u=1}^m (\cdot)$. The spectrum of $M$ is $\sigma(M)$, the number of structural nonzeros is $\operatorname{nnz}(M)$, and the dimension of a subspace $V$ is $\dim(V)$. Orthogonal and special orthogonal groups are $O(n)$ and $SO(n)$.

\section{BEG-0: Preliminaries}

The base objects $\mathsf{base}$ and identities $\mathsf{facts}_0$ now follow the bookkeeping format requested by the user.

\begin{align}
\boxed{[0.1]}\quad & \mathbb{N} \overset{\varnothing}{=} \{1,2,3,\dots\} &&({})\\
\boxed{[0.2]}\quad & d_h,d_c,D \in \underbrace{\mathbb{N}}_{[0.1]} &&([0.1])\\
\boxed{[0.3]}\quad & I_n \overset{\varnothing}{=} \{A \in \mathbb{R}^{n\times n} : A_{ij} = \delta_{ij}\} &&({})\\
\boxed{[0.4]}\quad & (\cdot)^\top : \mathbb{R}^{n\times m} \to \mathbb{R}^{m\times n},\quad (\cdot)^* : \mathbb{C}^{n\times m} \to \mathbb{C}^{m\times n},\\
& A^\top \overset{\varnothing}{=} \text{transpose}(A),\quad B^* \overset{\varnothing}{=} \overline{B}^\top &&({})\\
\boxed{[0.5]}\quad & [A,B] \overset{\varnothing}{=} AB-BA &&({})\\
\boxed{[0.6]}\quad & \mathbb{R}^n \overset{\varnothing}{=} \{ x \in \mathbb{R}^{n\times 1}\},\quad \mathbb{C}^n \overset{\varnothing}{=} \{ x \in \mathbb{C}^{n\times 1}\} &&([0.1])\\
\boxed{[0.7]}\quad & O(n) \overset{\varnothing}{=} \Big\{Q \in \mathbb{R}^{n\times n} \Big| \underbrace{Q^\top Q}_{[0.4]} \overset{[0.3]}{=} \underbrace{I_n}_{[0.3]}\Big\} &&([0.3],[0.4])\\
\boxed{[0.8]}\quad & SO(n) \overset{\varnothing}{=} \Big\{Q \in O(n) \mid \det(Q)=+1\Big\} &&([0.7])\\
\boxed{[0.9]}\quad & \exp(M) \overset{\varnothing}{=} \sum_{t=0}^{\infty} \frac{1}{t!} M^t,\quad M \in \mathbb{R}^{n\times n} &&([0.1])\\
\boxed{[0.10]}\quad & [M,N]=0 \Longrightarrow \exp(M+N) \overset{[0.9]}{=} \exp(M)\exp(N) &&([0.5],[0.9])\\
& \text{If } M = \begin{bmatrix}M_1 & 0\\0 & M_2\end{bmatrix},\ \exp(M) \overset{[0.9]}{=} \begin{bmatrix}\exp(M_1)&0\\0&\exp(M_2)\end{bmatrix} &&([0.9])\\
\boxed{[0.11]}\quad & J \overset{\varnothing}{=} \begin{bmatrix}0&-1\\1&0\end{bmatrix},\quad R_2(\theta) \overset{\varnothing}{=} \exp(\theta J) \overset{[0.9]}{=} \begin{bmatrix}\cos\theta & -\sin\theta\\ \sin\theta & \cos\theta\end{bmatrix} \in SO(2) &&([0.8],[0.9])\\
\boxed{[0.12]}\quad & R_2(a)^\top R_2(b) \overset{[0.11]}{=} R_2(-a)R_2(b) \overset{[0.10]}{=} R_2(b-a) &&([0.10],[0.11])\\
\boxed{[0.13]}\quad & S^\top = -S \Longrightarrow S_{ii}=0,\ S_{ji}=-S_{ij} &&([0.4])\\
\boxed{[0.14]}\quad & \det \begin{bmatrix}M_1&0\\0&M_2\end{bmatrix} = \det(M_1)\det(M_2) &&({})\\
\boxed{[0.15]}\quad & U(n) \overset{\varnothing}{=} \Big\{\mathcal{U} \in \mathbb{C}^{n\times n} : \mathcal{U}^\ast \mathcal{U} \overset{[0.4]}{=} I_n\Big\} &&([0.3],[0.4])\\
\boxed{[0.16]}\quad & \sigma(M) \overset{\varnothing}{=} \{\lambda \in \mathbb{C} : \exists x \in \mathbb{C}^n\setminus\{0\},\ Mx = \lambda x\} &&([0.6])
\end{align}

We also use $\ker(M) := \{x \in \mathbb{R}^n : Mx = 0\}$, $\operatorname{im}(M) := \{Mx : x \in \mathbb{R}^n\}$, $\dim(V)$ for the dimension of a subspace, $\operatorname{diag}(\lambda_1,\dots,\lambda_n) := [\delta_{ij}\lambda_i]_{i,j=1}^n$, and $\bigoplus_{u=1}^m M_u := \operatorname{diag}(M_1,\dots,M_m)$.

\section{BEG-1: Hypotheses and Structured Generator}

We fix the index sets $K := \{1,\dots,d_c\}$ and $H := \{1,\dots,d_h\}$ together with generators $\{L_k\}_{k\in K}$ and the coordinate vector $r \in \mathbb{R}^{d_c}$.

\begin{align}
\boxed{[1.2]}\quad & \forall k \in K:\ L_k \in \mathbb{R}^{d_h\times d_h},\ L_k^\top \overset{\varnothing}{=} -L_k &&([0.2],[0.4])\\
\boxed{[1.3]}\quad & \forall a,b \in K:\ [L_a,L_b] \overset{[0.5]}{=} L_aL_b-L_bL_a \overset{\varnothing}{=} 0_{d_h\times d_h} &&([0.5],[0.2])\\
\boxed{[1.4]}\quad & \forall r \in \mathbb{R}^{d_c}:\ A(r) \overset{\varnothing}{=} \sum_{k=1}^{d_c} \underbrace{L_k}_{[1.2]}\underbrace{[r]_k}_{[0.6]} &&([1.2],[0.6],[0.2])\\
\boxed{[1.5]}\quad & R_{\mathrm{STR}}(r) \overset{\varnothing}{=} \exp\big(\underbrace{A(r)}_{[1.4]}\big) &&([1.4],[0.9])
\end{align}

These hypotheses ensure $A(r)$ is skew-symmetric and that the $L_k$ commute, paving the way for the simultaneous block-rotation structure in BEG-2.

\section{BEG-2: Simultaneous Block Rotation Structure}

\subsection{Normality and Spectrum}

\begin{align}
\boxed{[2.1]}\quad & L^\top = -L \Longrightarrow L^\top L = (-L)L = -L^2,\ LL^\top = L(-L) = -L^2 \implies L \text{ is normal} &&([1.2],[0.4])\\
\boxed{[2.2]}\quad & L^\top = -L,\ Lx = \lambda x,\ x \neq 0 \Longrightarrow \lambda \in i\mathbb{R} &&([0.4])
\end{align}

\subsection{Simultaneous Diagonalisation}

\begin{align}
\boxed{[2.3]}\quad & \{L_k\}_{k\in K}\text{ normal and commuting } \Longrightarrow \exists \mathcal{U} \in U(d_h):\ 
\mathcal{U}^* L_k \mathcal{U} = \operatorname{diag}(i\lambda_{k,1},\dots,i\lambda_{k,d_h}) &&([1.2],[1.3],[2.1],[0.15],[0.16])
\end{align}

\subsection{Real Block Form and Projectors}

\begin{align}
\boxed{[2.4]}\quad & \exists U \in O(d_h),\ m,d_{\mathrm{null}} \in \mathbb{N}:\ 2m + d_{\mathrm{null}} = d_h,\\
& U^\top L_k U = \Big(\bigoplus_{u=1}^m B_{k,u}\Big) \oplus 0_{d_{\mathrm{null}}\times d_{\mathrm{null}}},\ B_{k,u}^\top = -B_{k,u} &&([1.2],[2.3],[0.7],[0.16])\\
\boxed{[2.5]}\quad & \forall u:\ B_{k,u} = \lambda_{k,u} J_u,\ J_u = \begin{bmatrix}0&-1\\1&0\end{bmatrix} &&([2.4],[0.11])\\
\boxed{[2.6]}\quad & \Pi_{\mathrm{act}} \overset{\varnothing}{=} U \begin{bmatrix}I_{2m}&0\\0&0\end{bmatrix} U^\top,\ \Pi_{\mathrm{null}} \overset{\varnothing}{=} U \begin{bmatrix}0&0\\0&I_{d_{\mathrm{null}}}\end{bmatrix} U^\top,\\
& \Pi_{\mathrm{act}}^2 = \Pi_{\mathrm{act}},\ \Pi_{\mathrm{null}}^2 = \Pi_{\mathrm{null}},\ \Pi_{\mathrm{act}}\Pi_{\mathrm{null}} = 0 &&([2.4],[0.3],[0.7])\\
\boxed{[2.7]}\quad & \beta_u \overset{\varnothing}{=} (\lambda_{1,u},\dots,\lambda_{d_c,u})^\top,\ [\beta_u]_k = \lambda_{k,u} &&([2.5])\\
\boxed{[2.8]}\quad & \theta_u(r) \overset{\varnothing}{=} \beta_u^\top r = \sum_{k=1}^{d_c} \underbrace{\lambda_{k,u}}_{[2.5]} \underbrace{[r]_k}_{[1.4]} &&([2.7],[1.4])
\end{align}

\begin{align}
\boxed{[2.9]}\quad & U^\top A(r) U = \sum_{k=1}^{d_c} \underbrace{U^\top L_k U}_{[2.4]} [r]_k \\
&= \Big(\bigoplus_{u=1}^m \theta_u(r) J_u\Big) \oplus 0_{d_{\mathrm{null}}\times d_{\mathrm{null}}} &&([1.4],[2.4],[2.5],[2.8])\\
\boxed{[2.10]}\quad & \exp\big(U^\top A(r) U\big) = \Big(\bigoplus_{u=1}^{m} R_2(\theta_u(r))\Big) \oplus I_{d_{\mathrm{null}}} &&([2.9],[0.10],[0.11])\\
\boxed{[2.11]}\quad & R_{\mathrm{STR}}(r) = U\Big[\Big(\bigoplus_{u=1}^{m} R_2(\theta_u(r))\Big) \oplus I_{d_{\mathrm{null}}}\Big]U^\top &&([1.5],[2.9],[2.10],[0.10],[0.7])\\
\boxed{[2.12]}\quad & R_{\mathrm{STR}}(r)^\top R_{\mathrm{STR}}(r) = I_{d_h},\ \det(R_{\mathrm{STR}}(r)) = 1 \Rightarrow R_{\mathrm{STR}}(r) \in SO(d_h) &&([2.11],[0.7],[0.8],[0.14])\\
\boxed{[2.13]}\quad & R_{\mathrm{STR}}(r_i)^\top R_{\mathrm{STR}}(r_j) = R_{\mathrm{STR}}(r_j-r_i) &&([2.11],[2.12],[0.12],[2.8])
\end{align}

\section{BEG-3: Cayley Post-Rotation}

We parameterise $P_{\mathrm{sp}}$ via an upper-triangular mask and Cayley transform.

\begin{align}
\boxed{[3.1]}\quad & U_{\mathrm{mask}} \in \{0,1\}^{d_h\times d_h},\ [U_{\mathrm{mask}}]_{ij}=0 \text{ for } i\ge j &&([0.2])\\
\boxed{[3.2]}\quad & \tilde{S} \in \mathbb{R}^{d_h\times d_h} &&([0.2])\\
\boxed{[3.3]}\quad & S_{ij} \overset{\varnothing}{=} [U_{\mathrm{mask}}]_{ij} \tilde{S}_{ij} \ (i<j),\ S_{ji} \overset{\varnothing}{=} -S_{ij},\ S_{ii} \overset{\varnothing}{=} 0 &&([3.1],[3.2],[0.13])\\
\boxed{[3.4]}\quad & S^\top = -S &&([3.3],[0.4])\\
\boxed{[3.5]}\quad & \operatorname{nnz}(S) \le 2\, \operatorname{nnz}(U_{\mathrm{mask}}) &&([3.1],[3.3])\\
\boxed{[3.6]}\quad & S^\top = -S \Longrightarrow \sigma(S) \subseteq \{0\}\cup i\mathbb{R} &&([3.4],[0.16])\\
\boxed{[3.6\mathrm{a}]}\quad & -1 \notin \sigma(S) \Longrightarrow (I_{d_h}+S)^{-1} \text{ exists} &&([3.6],[0.3])\\
\boxed{[3.7]}\quad & P_{\mathrm{sp}} \overset{\varnothing}{=} (I_{d_h}-S)(I_{d_h}+S)^{-1} &&([3.6],[0.3])\\
\boxed{[3.8]}\quad & P_{\mathrm{sp}}^\top P_{\mathrm{sp}} = I_{d_h} &&([3.4],[3.7],[0.4],[0.3])\\
\boxed{[3.9]}\quad & S w = i\mu w \Rightarrow P_{\mathrm{sp}} w = \frac{1-i\mu}{1+i\mu} w,\ |\frac{1-i\mu}{1+i\mu}|=1 &&([3.4],[3.7],[0.16])\\
\boxed{[3.10]}\quad & P_{\mathrm{sp}} \in SO(d_h) \Longleftrightarrow P_{\mathrm{sp}}^\top P_{\mathrm{sp}}=I_{d_h},\ \det(P_{\mathrm{sp}})=1 &&([3.8],[3.9],[0.8])
\end{align}

Let $\mathbb{R}^{d_h} = \mathrm{act} \oplus \mathrm{null}$ be the $U$-aligned decomposition.

\begin{align}
\boxed{[3.11]}\quad & \dim(\mathrm{act}) = 2m,\ \dim(\mathrm{null}) = d_{\mathrm{null}} = d_h-2m &&([2.4],[2.6],[0.16])\\
\boxed{[3.12]}\quad & U_{\mathrm{mask}} \text{ supported in null} \times \text{null} \\
&\Longrightarrow S = \begin{bmatrix}0&0\\0&S_{\mathrm{null}}\end{bmatrix},\ P_{\mathrm{sp}} = \begin{bmatrix}I_{2m}&0\\0&R_{\mathrm{null}}\end{bmatrix},\ R_{\mathrm{null}} \in SO(d_{\mathrm{null}}) &&([3.1],[3.3],[3.7],[3.10],[2.4])\\
\boxed{[3.13]}\quad & \mathcal{A} \overset{\varnothing}{=} \Big\{P \in SO(d_h) \mid P = \begin{bmatrix}I_{2m}&0\\0&R_{\mathrm{null}}\end{bmatrix},\ R_{\mathrm{null}} \in SO(d_{\mathrm{null}})\Big\} &&([0.8],[3.11])\\
\boxed{[3.14]}\quad & \mathcal{B} \overset{\varnothing}{=} \Big\{P_{\mathrm{sp}} : P_{\mathrm{sp}} = (I_{d_h}-S)(I_{d_h}+S)^{-1},\ S^\top=-S\Big\} &&([3.7])\\
\boxed{[3.15]}\quad & \mathcal{A} \subseteq \mathcal{B} \subseteq SO(d_h) &&([3.10],[3.12],[3.13])
\end{align}

\section{BEG-4: Composed Rotation and Relative/Absolute Behaviour}

\begin{align}
\boxed{[4.1]}\quad & R_{\mathrm{sp}}(r) \overset{\varnothing}{=} \underbrace{R_{\mathrm{STR}}(r)}_{[2.11]}\underbrace{P_{\mathrm{sp}}}_{[3.7]} &&([2.11],[3.7])\\
\boxed{[4.2]}\quad & R_{\mathrm{sp}}(r)^\top R_{\mathrm{sp}}(r) = I_{d_h},\ \det(R_{\mathrm{sp}}(r))=1 \Rightarrow R_{\mathrm{sp}}(r) \in SO(d_h) &&([4.1],[2.12],[3.10],[0.8])
\end{align}

When $P_{\mathrm{sp}} \in \mathcal{A}$ the active block is untouched.

\begin{align}
\boxed{[4.3]}\quad & P_{\mathrm{sp}} \in \mathcal{A} \Longrightarrow \Pi_{\mathrm{act}} R_{\mathrm{sp}}(r) \Pi_{\mathrm{act}} = \Pi_{\mathrm{act}} R_{\mathrm{STR}}(r) \Pi_{\mathrm{act}} &&([4.1],[3.13],[2.6])\\
\boxed{[4.4]}\quad & P_{\mathrm{sp}} \in \mathcal{A} \Longrightarrow \Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_i)^\top R_{\mathrm{sp}}(r_j) \Pi_{\mathrm{act}} = \Pi_{\mathrm{act}} R_{\mathrm{STR}}(r_j-r_i) \Pi_{\mathrm{act}} &&([4.1],[4.3],[2.13],[3.13],[2.6])
\end{align}

If $P_{\mathrm{sp}} \in \mathcal{B}\setminus\mathcal{A}$ we can write $P_{\mathrm{sp}} = \begin{bmatrix}A&B\\C&D\end{bmatrix}$ with $B \neq 0$ or $C \neq 0$.

\begin{align}
\boxed{[4.5]}\quad & P_{\mathrm{sp}} \in \mathcal{B}\setminus\mathcal{A} \Longrightarrow \Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_i)^\top R_{\mathrm{sp}}(r_j) \Pi_{\mathrm{act}} \neq \Pi_{\mathrm{act}} R_{\mathrm{STR}}(r_j-r_i) \Pi_{\mathrm{act}} &&([3.14],[4.1],[2.13],[2.6])
\end{align}

\section{BEG-5: Attention Logits}

\begin{align}
\boxed{[5.1]}\quad & W_Q,W_K,W_V \in \mathbb{R}^{d_h\times D},\ x_i \in \mathbb{R}^{D},\ r_i \in \mathbb{R}^{d_c} &&([0.2])\\
\boxed{[5.2]}\quad & q_i \overset{\varnothing}{=} W_Q x_i,\ k_i \overset{\varnothing}{=} W_K x_i,\ v_i \overset{\varnothing}{=} W_V x_i &&([5.1])\\
\boxed{[5.3]}\quad & q_i^{(\mathrm{act})} \overset{\varnothing}{=} \Pi_{\mathrm{act}} q_i,\ k_j^{(\mathrm{act})} \overset{\varnothing}{=} \Pi_{\mathrm{act}} k_j &&([5.2],[2.6])\\
\boxed{[5.4]}\quad & d_{\mathrm{act}} \overset{\varnothing}{=} \dim(\mathrm{act}) = 2m &&([2.4],[3.11],[0.16])\\
\boxed{[5.5]}\quad & \tilde{q}_i \overset{\varnothing}{=} \Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_i) q_i^{(\mathrm{act})},\ \tilde{k}_j \overset{\varnothing}{=} \Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_j) k_j^{(\mathrm{act})} &&([4.1],[5.3],[2.6])\\
\boxed{[5.6]}\quad & \alpha_{ij} \overset{\varnothing}{=} \frac{\tilde{q}_i^\top \tilde{k}_j}{\sqrt{d_{\mathrm{act}}}} &&([5.5],[5.4])\\
\boxed{[5.7]}\quad & \alpha_{ij} = \frac{(q_i^{(\mathrm{act})})^\top\big[(\Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_i) \Pi_{\mathrm{act}})^\top (\Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_j) \Pi_{\mathrm{act}})\big] k_j^{(\mathrm{act})}}{\sqrt{d_{\mathrm{act}}}} &&([5.6],[5.5],[5.3],[2.6])\\
\boxed{[5.8]}\quad & P_{\mathrm{sp}} \in \mathcal{A} \Longrightarrow (\Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_i) \Pi_{\mathrm{act}})^\top(\Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_j) \Pi_{\mathrm{act}}) = \Pi_{\mathrm{act}} R_{\mathrm{sp}}(r_j-r_i) \Pi_{\mathrm{act}} &&([4.4],[4.1],[2.13],[2.6],[3.13])\\
\boxed{[5.9]}\quad & P_{\mathrm{sp}} \in \mathcal{A} \Longrightarrow \alpha_{ij} = \frac{(q_i^{(\mathrm{act})})^\top[\Pi_{\mathrm{act}} R_{\mathrm{STR}}(r_j-r_i) \Pi_{\mathrm{act}}]k_j^{(\mathrm{act})}}{\sqrt{d_{\mathrm{act}}}} &&([5.7],[5.8],[4.4],[2.13],[5.4])\\
\boxed{[5.10]}\quad & P_{\mathrm{sp}} \in \mathcal{B}\setminus\mathcal{A} \Longrightarrow \alpha_{ij} \neq \frac{(q_i^{(\mathrm{act})})^\top[\Pi_{\mathrm{act}} R_{\mathrm{STR}}(r_j-r_i) \Pi_{\mathrm{act}}]k_j^{(\mathrm{act})}}{\sqrt{d_{\mathrm{act}}}} &&([4.5],[5.7],[4.1],[2.13],[3.14],[5.4])
\end{align}

\section{BEG-6: Summary and Fatal Check}

Assuming $[1.2]$ and $[1.3]$, the statements $[2.1]$ through $[5.10]$ show:

\begin{itemize}
    \item $R_{\mathrm{STR}}(r)$ has the block-rotation form $[2.11]$, lies in $SO(d_h)$ $[2.12]$, and satisfies the relative-offset identity $[2.13]$.
    \item The Cayley transform parametrisation $[3.7]$ yields $P_{\mathrm{sp}} \in SO(d_h)$ with controllable sparsity $[3.5]$; masks supported on the null block give $\mathcal{A}$ $[3.12]$ while all masks give $\mathcal{B}$ $[3.14]$.
    \item $R_{\mathrm{sp}}(r)$ preserves purely relative offsets on the active block when $P_{\mathrm{sp}} \in \mathcal{A}$ $[4.4]$, but leaks absolute position for $P_{\mathrm{sp}} \notin \mathcal{A}$ $[4.5]$.
    \item Attention logits $\alpha_{ij}$ inherit the relative-offset dependence when $P_{\mathrm{sp}} \in \mathcal{A}$ $[5.9]$ and include absolute information otherwise $[5.10]$.
\end{itemize}

The auxiliary cleanups $\mathsf{cleanup}$ add the explicit references requested by the reviewer without affecting hypotheses $[1.2]$â€“$[1.3]$ or constructions $[2.11]$, $[3.7]$, $[4.1]$, so statement $[5.9]$ remains the main theorem.

\end{document}
